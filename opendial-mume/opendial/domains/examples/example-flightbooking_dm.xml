<?xml version="1.0" encoding="UTF-8"?>\n<domain>\n	<!-- Dialogue management models, composed of three models: an action selection \n		model to find the best system action to execute, a transition model that \n		specifies how the selected action modifies the current dialogue state, and \n		a prediction model for the prior distributions on the destinations, \n		departures and next user dialogue act. -->\n\n	<model trigger="Destination,Departure,Date,ReturnDate,NbTickets">\n		<!-- This model specifies the utilities of various system actions, such \n			as clarification requests (repetitions and confirmations) and \n			grounding actions. -->\n\n		<!-- If the current step is to ask for the destination, specifies the utilities \n			of a confirmation request or a grounding action using the current value of \n			the "Destination" slot -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="Destination" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(Destination,{Destination})" />\n				</effect>\n				<effect util="0.5">\n					<set var="a_m" value="Confirm(Destination,{Destination})" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask for the departure, specifies the utilities \n			of a confirmation request or a grounding action using the current value of \n			the "Departure" slot -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="Departure" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(Departure,{Departure})" />\n				</effect>\n				<effect util="0.5">\n					<set var="a_m" value="Confirm(Departure,{Departure})" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask for the flight date, specifies the utilities \n			of a confirmation request or a grounding action using the current value of \n			the "Date" slot -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="Date" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(Date,{Date})" />\n				</effect>\n				<effect util="0.5">\n					<set var="a_m" value="Confirm(Date,{Date})" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask whether to book a round-trip ticket \n			and the user answers yes, specifies the utility of asking for the return \n			date. -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="Return" />\n					<if var="a_u" relation="contains" value="Confirm" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(Return)" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="current_step" value="Return" />\n					<if var="a_u" relation="contains" value="Disconfirm" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(NoReturn)" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask for the return date, specifies the utilities \n			of a confirmation request or a grounding action using the current value of \n			the "ReturnDate" slot -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="ReturnDate" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(ReturnDate,{ReturnDate})" />\n				</effect>\n				<effect util="0.5">\n					<set var="a_m" value="Confirm(ReturnDate,{ReturnDate})" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask whether to proceed with the booking \n			and the user answers yes, specifies the utility of asking for the number \n			of tickets. -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="MakeOffer" />\n					<if var="a_u" relation="contains" value="Confirm" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(MakeOffer)" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask whether to proceed with the booking \n			and the user answers no, specifies the utility of grounding the cancel action. -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="MakeOffer" />\n					<if var="a_u" relation="contains" value="Disconfirm" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(Cancel)" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask for the number of tickets, specifies \n			the utilities of a confirmation request or a grounding action using the current \n			value of the "NbTickets" slot -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="NbTickets" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(NbTickets,{NbTickets})" />\n				</effect>\n				<effect util="0.5">\n					<set var="a_m" value="Confirm(NbTickets,{NbTickets})" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask for a last confirmation and the user \n			answers yes, specifies the utility of grounding the booking. -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="LastConfirm" />\n					<if var="a_u" relation="contains" value="Confirm" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(Booking)" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="current_step" value="LastConfirm" />\n					<if var="a_u" relation="contains" value="Disconfirm" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(Cancel)" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask whether to book additional tickets and \n			the user answers yes, specifies the utility of restarting the interaction. -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="Final" />\n					<if var="a_u" relation="contains" value="Confirm" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(Restart)" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- If the current step is to ask whether to book additional tickets and \n			the user answers no, specifies the utility of closing the interaction. -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="Final" />\n					<if var="a_u" relation="contains" value="Disconfirm" />\n				</condition>\n				<effect util="5">\n					<set var="a_m" value="Ground(Close)" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- Specifies the utility of a repetition request -->\n		<rule>\n			<case>\n				<condition>\n					<if var="a_u" relation="!=" value="None" />\n				</condition>\n				<effect util="0.1">\n					<set var="a_m" value="AskRepeat" />\n				</effect>\n			</case>\n		</rule>\n\n		<!-- Specifies the "base" utility of all possible actions, in the absence \n			of any other information (allows to set an implicit threshold on the system \n			confidence before selecting a particular action). -->\n		<rule>\n			<case>\n				<effect util="-4.5">\n					<set var="a_m" value="Ground(*)" />\n				</effect>\n				<effect util="-0.3">\n					<set var="a_m" value="Confirm(*)" />\n				</effect>\n				<effect util="-0.03">\n					<set var="a_m" value="AskRepeat" />\n				</effect>\n			</case>\n		</rule>\n		\n		\n		<!-- Records the next-to-last system action -->\n		<rule>\n			<case>\n				<effect>\n					<set var="a_m-prev" value="{a_m}" />\n				</effect>\n			</case>\n		</rule>\n\n	</model>\n	\n	\n\n\n	<model trigger="a_m">\n		<!-- Transition model that specifies how the selection of a particular \n			system action affects the current dialogue state, in particular the current \n			step in the dialogue. -->\n\n		<!-- Moves to the next step if a particular slot has been confirmed -->\n		<rule>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(Destination,*)" />\n				</condition>\n				<effect prob="1">\n					<set var="current_step" value="Departure" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(Departure,*)" />\n				</condition>\n				<effect prob="1">\n					<set var="current_step" value="Date" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(Date,*)" />\n				</condition>\n				<effect prob="1">\n					<set var="current_step" value="Return" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(Return)" />\n				</condition>\n				<effect prob="1">\n					<set var="current_step" value="ReturnDate" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(NoReturn)" />\n				</condition>\n				<effect prob="1">\n					<set var="ReturnDate" value="NoReturn" />\n					<set var="a_m-prev" value="{a_m}" />\n					<set var="a_m" value="FindOffer" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(ReturnDate,*)" />\n				</condition>\n				<effect prob="1">\n					<set var="a_m-prev" value="{a_m}" />\n					<set var="a_m" value="FindOffer" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(MakeOffer)" />\n				</condition>\n				<effect prob="1">\n					<set var="current_step" value="NbTickets" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(Cancel)" />\n				</condition>\n				<effect prob="1">\n					<set var="current_step" value="Final" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(NbTickets,{Number})" />\n				</condition>\n				<effect prob="1">\n					<set var="current_step" value="LastConfirm" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(Booking)" />\n				</condition>\n				<effect prob="1">\n					<set var="a_m-prev" value="{a_m}" />\n					<set var="a_m" value="Book"/>\n					<set var="current_step" value="Final" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(Restart)" />\n				</condition>\n				<effect prob="1">\n					<set var="current_step" value="Destination" />\n					<set var="Destination" value="None" />\n					<set var="Departure" value="None" />\n					<set var="Date" value="None" />\n					<set var="ReturnDate" value="None" />\n					<set var="NbTickets" value="None" />\n					<set var="TotalCost" value="None" />\n					<set var="a_u" value="None" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(Close)" />\n				</condition>\n				<effect prob="1">\n					<set var="current_step" value="Close" />\n				</effect>\n			</case>\n		</rule>\n\n\n		<!-- If the external module produces the system action MakeOffer(particular price),\n		registers the price in a separate variable and moves the current step. -->\n		<rule>\n			<case>\n				<condition>\n					<if var="a_m" value="MakeOffer({Price})" />\n				</condition>\n				<effect>\n					<set var="TotalCost" value="{Price}" />\n					<set var="current_step" value="MakeOffer" />\n				</effect>\n			</case>\n		<!-- If the number of tickets is grounded, update the total cost by multiplying the\n		price with the number of tickets. -->\n			<case>\n				<condition>\n					<if var="a_m" value="Ground(NbTickets,*)" />\n				</condition>\n				<effect>\n					<set var="TotalCost" value="{TotalCost}*{NbTickets}" />\n				</effect>\n			</case>\n		</rule>\n\n	</model>\n	\n	<model trigger="a_m,current_step">\n		<!-- Specifies the prior distributions for the destinations, departures and\n		responses to yes/no questions -->\n	\n		<!-- Prior probabilities for the destinations and departures -->\n		<rule>\n			<case>\n				<condition>\n					<if var="current_step" value="Destination" />\n				</condition>\n				<effect prob="0.25">\n					<set var="Destination^p" value="Oslo" />\n				</effect>\n				<effect prob="0.15">\n					<set var="Destination^p" value="Bergen" />\n				</effect>\n				<effect prob="0.1">\n					<set var="Destination^p" value="Trondheim" />\n				</effect>\n				<effect prob="0.1">\n					<set var="Destination^p" value="Stavanger" />\n				</effect>\n				<effect prob="0.1">\n					<set var="Destination^p" value="Moss" />\n				</effect>\n				<effect prob="0.1">\n					<set var="Destination^p" value="Sandefjord" />\n				</effect>\n				<effect prob="0.05">\n					<set var="Destination^p" value="Tromsø" />\n				</effect>\n				<effect prob="0.05">\n					<set var="Destination^p" value="Bodø" />\n				</effect>\n				<effect prob="0.05">\n					<set var="Destination^p" value="Kristiansand" />\n				</effect>\n				<effect prob="0.05">\n					<set var="Destination^p" value="Ålesund" />\n				</effect>\n			</case>\n			<case>\n				<condition>\n					<if var="current_step" value="Departure" />\n				</condition>\n				<effect prob="0.25">\n					<set var="Departure^p" value="Oslo" />\n				</effect>\n				<effect prob="0.15">\n					<set var="Departure^p" value="Bergen" />\n				</effect>\n				<effect prob="0.1">\n					<set var="Departure^p" value="Trondheim" />\n				</effect>\n				<effect prob="0.1">\n					<set var="Departure^p" value="Stavanger" />\n				</effect>\n				<effect prob="0.1">\n					<set var="Departure^p" value="Moss" />\n				</effect>\n				<effect prob="0.1">\n					<set var="Departure^p" value="Sandefjord" />\n				</effect>\n				<effect prob="0.05">\n					<set var="Departure^p" value="Tromsø" />\n				</effect>\n				<effect prob="0.05">\n					<set var="Departure^p" value="Bodø" />\n				</effect>\n				<effect prob="0.05">\n					<set var="Departure^p" value="Kristiansand" />\n				</effect>\n				<effect prob="0.05">\n					<set var="Departure^p" value="Ålesund" />\n				</effect>\n			</case>\n		</rule>\n		\n		\n			<!-- Prediction rule on the next user dialogue act (the probabilities\n		are here quite low to account for a range of unexpected responses)   -->\n		<rule>\n			<case>\n				<condition>\n					<if var="a_m" value="(AskRepeat|None)"/>\n					<if var="a_u" relation="!=" value="None"/>\n					<if var="a_u" relation="!=" value="[Other]"/>\n				</condition>\n				<effect prob="0.3">\n					<set var="a_u^p" value="{a_u}"/>\n				</effect>\n			</case>\n			<case>\n				<condition operator="or">\n					<if var="a_m" value="Confirm(*)"/>\n					<if var="current_step" value="Return"/>\n					<if var="current_step" value="MakeOffer"/>\n					<if var="current_step" value="LastConfirm"/>\n					<if var="current_step" value="Final"/>\n				</condition>\n				<effect prob="0.2">\n					<set var="a_u^p" value="[Confirm]"/>\n				</effect>\n				<effect prob="0.2">\n					<set var="a_u^p" value="[Disconfirm]"/>\n				</effect>\n			</case>\n			<case>\n				<effect>\n					<set var="a_u^p" value="None"/>\n				</effect>\n			</case>\n		</rule>\n		\n	</model>\n\n</domain>\n